fastlane_require 'net/https'
fastlane_require 'uri'
fastlane_require 'json'

METAJSON_TEMP_FOLDERNAME = ".MetaJSON-temp"
FASTLANE_COMMONS_FOLDER_NAME = ".SMF-iOS-Fastlane-Commons"

before_all do

  UI.important("Cloning the commons repo and importing the internal Fastfile")

  fastlane_commons_branch = build_variants_config["project"]["fastlane_commons_branch"]
  sh "git clone -b \"" + fastlane_commons_branch + "\" git@github.com:smartmobilefactory/SMF-iOS-Fastlane-Commons.git #{FASTLANE_COMMONS_FOLDER_NAME}"

  import "#{FASTLANE_COMMONS_FOLDER_NAME}/Fastlane/Core_Fastfile"
end

after_all do
  sh "if [ -d #{FASTLANE_COMMONS_FOLDER_NAME} ]; then rm -rf #{FASTLANE_COMMONS_FOLDER_NAME}; fi"
end
